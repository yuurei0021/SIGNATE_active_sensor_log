# 20251120_09_test01014_investigation

## 目的
test_01014の実際のセンサーデータを可視化・分析し、walkingかstairsかを視覚的に判断する。

## 背景
- **ベースラインモデル**: walking 86.62%, stairs 12.44%
- **改善版モデル**: walking 62.13%, stairs 37.24%
- **正解ラベル**: 不明
- **問題**: どちらのモデルが正しいか判断できない

## アプローチ
1. test_01014のセンサーデータを読み込み
2. trainデータから代表的なwalking/stairsサンプルを選択（各8件）
3. 時系列パターンを可視化
4. Z軸パターンに特化した可視化（stairsの特徴的な動き）
5. 統計的特徴量を計算して類似度を測定

## 結果

### 特徴量ベースの類似度分析

| 特徴量 | test_01014 | Walking平均 | Stairs平均 |
|--------|-----------|------------|-----------|
| Y軸標準偏差 | 5.59 | 5.88 | 4.59 |
| Z軸標準偏差 | 5.46 | 7.16 | 5.03 |
| 合成加速度平均 | 12.25 | 13.43 | 11.05 |
| 合成加速度標準偏差 | 5.59 | 6.39 | 5.25 |
| Z軸ピーク数 | 2 | 2.5 | 3.25 |
| Z軸谷数 | 4 | 3.25 | 3.25 |
| Z軸レンジ | 33.27 | 37.77 | 26.88 |

### 正規化距離による類似度

- **Walkingまでの距離**: 3.80
- **Stairsまでの距離**: 4.24

**結論**: test_01014は**Walkingに10.6%近い**

### 視覚的分析

#### 時系列パターン（comparison_timeseries.png）
- test_01014のパターンはwalking（青）サンプルにより類似
- 特にY軸（前後方向）の振動パターンがwalkingと一致
- stairsサンプルは全体的により複雑でノイジーなパターン

#### Z軸分析（comparison_z_axis.png）
- test_01014のZ軸パターンは比較的smooth
- Walkingサンプル（青）も同様にsmoothなパターン
- Stairsサンプル（赤）はより急峻な変動が特徴的
- test_01014には階段昇降時の典型的な規則的な上下動が見られない

### 特徴量の詳細比較

1. **Y軸標準偏差（前後方向の動き）**
   - test_01014: 5.59（walkingとstairsの中間だがwalkingに近い）
   - walkingは前後の大きな動きが特徴

2. **Z軸標準偏差（上下方向の動き）**
   - test_01014: 5.46（stairsの5.03に近い）
   - しかし、パターンの質が異なる（後述）

3. **合成加速度**
   - test_01014: 12.25（walkingの13.43に近い）
   - 全体的な動きの強度がwalkingレベル

4. **Z軸のピーク・谷パターン**
   - test_01014: ピーク2回、谷4回
   - stairsは規則的な上下動で両方とも多い傾向
   - test_01014は不規則で、walkingパターンに近い

## 結論

### Visual Evidence（視覚的証拠）

**test_01014は高確率でWalkingである**

以下の根拠から判断：

1. **特徴量ベースの類似度**: walkingに10.6%近い
2. **時系列パターン**: walkingサンプルと視覚的に類似
3. **Z軸パターン**: 階段昇降の規則的な上下動が見られない
4. **Y軸の動き**: 前後方向の動きがwalkingと一致
5. **合成加速度**: walkingレベルの動き強度

### モデル性能への示唆

この分析結果は**ベースラインモデル（20251120_05）を支持**：

| モデル | Walking確率 | Stairs確率 | 判定 |
|--------|-----------|-----------|------|
| ベースライン | 86.62% | 12.44% | より正確と思われる |
| 改善版 | 62.13% | 37.24% | 過剰にstairsに引き寄せられた |

### 重要な示唆

1. **Stairsクラス重み5倍は過剰だった可能性**
   - walkingとstairsの境界付近サンプルが過度にstairsに分類される
   - test_01014のような明らかにwalkingのサンプルでもstairs確率37%

2. **OOF scoreの限界**
   - 改善版のOOF score（0.9988）はベースライン（0.9950）より高い
   - しかしこれはtrainデータでのstairs分類改善によるもの
   - testデータでは逆にwalking分類が悪化している可能性

3. **Public LB 100%の解釈**
   - 両モデルともPublic LB 100%だが、異なる理由の可能性
   - Public LBに含まれるサンプルがたまたま両モデルで正解だった
   - Private LBで差が出る可能性が高い

## 最終推奨の変更

**この分析結果を受けて、推奨モデルを変更すべき：**

### 新しい推奨: **ベースラインモデル（20251120_05）**

**理由:**
1. test_01014の視覚分析でwalkingと判定
2. ベースラインの予測（walking 86.62%）が正しい可能性が高い
3. 改善版は過度にstairsに引き寄せられている（walking 62.13%、stairs 37.24%）
4. OOF scoreだけでは判断できない（trainとtestの分布が異なる可能性）

### リスク評価の更新

**改善版のリスク:**
- test_01014のようなwalking-stairs境界サンプルで誤分類の可能性
- stairsクラス重み5倍が過剰調整だった
- Private LBでスコア低下の懸念

**ベースラインの利点:**
- より保守的で安定した予測
- 境界サンプルでの確信度が適切
- test_01014の視覚分析結果と一致

## 実行方法

```bash
cd experiments/20251120_09_test01014_investigation
uv run python main.py
```

## 出力ファイル
- `comparison_timeseries.png`: test_01014とtrain サンプルの時系列比較
- `comparison_z_axis.png`: Z軸に特化したパターン分析

## 次のステップ
1. この分析結果を20251120_08_model_comparisonのREADMEに反映
2. 提出モデルの推奨を**ベースライン（20251120_05）に変更**
3. 改善版をバックアップとして保持
4. Private LB結果で検証
